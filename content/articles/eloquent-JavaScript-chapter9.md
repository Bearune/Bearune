---
category: å‰ç«¯é–‹ç™¼
title: ã€JavaScript å­¸ç¿’ç­†è¨˜ 09ã€‘æ­£å‰‡è¡¨é”å¼ Chapter 9 Regular Expressions
description: æ·±å…¥æ·ºå‡ºå­¸ç¿’ JavaScript æ­£å‰‡è¡¨é”å¼ï¼æœ¬ç³»åˆ—å…§å®¹æ˜¯åŸºæ–¼ Eloquent JavaScript 4th edition (2024) æ‰€æ•´ç†çš„ç²¾ç°¡ç­†è¨˜ã€‚æœ¬ç¯‡ç­†è¨˜å¾æ­£å‰‡è¡¨é”å¼çš„åŸºæœ¬æ¦‚å¿µå‡ºç™¼ï¼Œè©³ç´°ä»‹ç´¹äº† JavaScript ä¸­çš„å­—å…ƒé›†åˆã€é‡è¤‡æ¨¡å¼ã€åˆ†çµ„åŒ¹é…ç­‰æ ¸å¿ƒæ©Ÿåˆ¶ã€‚å¾åŸºç¤èªæ³•åˆ°é€²éšæ‡‰ç”¨ï¼Œå¾åŒ¹é…åŸç†åˆ°æ•ˆèƒ½å„ªåŒ–ï¼Œå®Œæ•´å‘ˆç¾äº†æ­£å‰‡è¡¨é”å¼çš„å¯¦æˆ°æŠ€å·§ã€‚å…§å®¹æ¶µè“‹äº†è²ªå©ªåŒ¹é…ã€å‰ç»å¾Œé¡§ã€é‚Šç•Œæ¢ä»¶ç­‰é‡è¦æ¦‚å¿µï¼Œä¸¦é€šéå¯¦éš›æ¡ˆä¾‹å±•ç¤ºäº†é€™äº›æ¦‚å¿µçš„æ‡‰ç”¨ã€‚é€éå¾ªåºæ¼¸é€²çš„æ–¹å¼ï¼Œå¹«åŠ©è®€è€…æŒæ¡å¦‚ä½•éˆæ´»é‹ç”¨æ­£å‰‡è¡¨é”å¼é€²è¡Œæ–‡å­—è™•ç†ã€‚
tags: ['javascript', 'Eloquent JavaScript å­¸ç¿’ç­†è¨˜ç³»åˆ—']
date: 2025-01-18
keywords: JavaScript æ­£å‰‡è¡¨é”å¼, JavaScript RegExp, JavaScript å­—å…ƒé›†åˆ, JavaScript é‡è¤‡æ¨¡å¼, JavaScript åˆ†çµ„åŒ¹é…, JavaScript è²ªå©ªåŒ¹é…, JavaScript éè²ªå©ªåŒ¹é…, JavaScript å‰ç»å¾Œé¡§, JavaScript é‚Šç•Œæ¢ä»¶, JavaScript exec, JavaScript match, JavaScript matchAll, JavaScript replace, JavaScript search, JavaScript å­—ä¸²è™•ç†, JavaScript æ–‡å­—åŒ¹é…, JavaScript æ­£å‰‡æ•ˆèƒ½, JavaScript æ­£å‰‡å„ªåŒ–, JavaScript æ­£å‰‡æ‡‰ç”¨, JavaScript å­¸ç¿’ç­†è¨˜, JavaScript å…¥é–€æ•™å­¸, JavaScript ç¯„ä¾‹, Eloquent JavaScript, Regular Expression, Pattern Matching
image: /img/articles/eloquent-JavaScript/cover9.webp
draft: false

head:
  - - meta
    - property: og:title
      content: ã€JavaScript å­¸ç¿’ç­†è¨˜ 09ã€‘æ­£å‰‡è¡¨é”å¼ Chapter 9 Regular Expressions
  - - meta
    - property: og:type
      content: article
  - - meta
    - property: og:image
      content: https://bearune.com/img/articles/eloquent-JavaScript/cover9.webp
  - - meta
    - property: og:url
      content: https://bearune.com/articles/eloquent-javascript-chapter9
  - - meta
    - property: og:description
      content: æ·±å…¥æ·ºå‡ºå­¸ç¿’ JavaScript æ­£å‰‡è¡¨é”å¼ï¼æœ¬ç³»åˆ—å…§å®¹æ˜¯åŸºæ–¼ Eloquent JavaScript 4th edition (2024) æ‰€æ•´ç†çš„ç²¾ç°¡ç­†è¨˜ã€‚æœ¬ç¯‡ç­†è¨˜å¾æ­£å‰‡è¡¨é”å¼çš„åŸºæœ¬æ¦‚å¿µå‡ºç™¼ï¼Œè©³ç´°ä»‹ç´¹äº† JavaScript ä¸­çš„å­—å…ƒé›†åˆã€é‡è¤‡æ¨¡å¼ã€åˆ†çµ„åŒ¹é…ç­‰æ ¸å¿ƒæ©Ÿåˆ¶ã€‚å¾åŸºç¤èªæ³•åˆ°é€²éšæ‡‰ç”¨ï¼Œå¾åŒ¹é…åŸç†åˆ°æ•ˆèƒ½å„ªåŒ–ï¼Œå®Œæ•´å‘ˆç¾äº†æ­£å‰‡è¡¨é”å¼çš„å¯¦æˆ°æŠ€å·§ã€‚å…§å®¹æ¶µè“‹äº†è²ªå©ªåŒ¹é…ã€å‰ç»å¾Œé¡§ã€é‚Šç•Œæ¢ä»¶ç­‰é‡è¦æ¦‚å¿µï¼Œä¸¦é€šéå¯¦éš›æ¡ˆä¾‹å±•ç¤ºäº†é€™äº›æ¦‚å¿µçš„æ‡‰ç”¨ã€‚é€éå¾ªåºæ¼¸é€²çš„æ–¹å¼ï¼Œå¹«åŠ©è®€è€…æŒæ¡å¦‚ä½•éˆæ´»é‹ç”¨æ­£å‰‡è¡¨é”å¼é€²è¡Œæ–‡å­—è™•ç†ã€‚


sitemap:
  loc: /articles/eloquent-javascript-chapter9
  lastmod: 2025-01-18
  changefreq: monthly
  priority: 0.5
---

æœ¬ç³»åˆ—å…§å®¹æ˜¯åŸºæ–¼ [Eloquent JavaScript 4th edition (2024)](https://eloquentjavascript.net/){target="_blank"} æ‰€æ•´ç†çš„ç²¾ç°¡ç­†è¨˜ã€‚

> Some people, when confronted with a problem, think â€˜I know, Iâ€™ll use regular expressions.â€™ Now they have two problems.â”€â”€ Jamie Zawinski

![ã€JavaScript å­¸ç¿’ç­†è¨˜ 09ã€‘æ­£å‰‡è¡¨é”å¼ Chapter 9 Regular Expressions](/img/articles/eloquent-JavaScript/cover9.webp)

æœ¬æ–‡æ·±å…¥æ¢è¨ JavaScript ä¸­çš„æ­£å‰‡è¡¨é”å¼æ©Ÿåˆ¶ï¼Œå¾åŸºç¤çš„å­—å…ƒé›†åˆå®šç¾©ï¼Œåˆ°é€²éšçš„åŒ¹é…ç­–ç•¥ã€‚é€éå¯¦éš›çš„ç¨‹å¼ç¢¼ç¯„ä¾‹ï¼Œèªªæ˜å¦‚ä½•é‹ç”¨é‡è¤‡æ¨¡å¼ã€åˆ†çµ„åŒ¹é…ã€è²ªå©ªåŒ¹é…ç­‰é‡è¦ç‰¹æ€§ä¾†æå‡æ–‡å­—è™•ç†çš„æ•ˆç‡å’Œéˆæ´»æ€§ã€‚åŒæ™‚ä¹Ÿä»‹ç´¹äº† JavaScript ç‰¹æœ‰çš„æ­£å‰‡è¡¨é”å¼æ–¹æ³•ï¼Œä»¥åŠ INI æª”æ¡ˆè§£æå¯¦éš›æ‡‰ç”¨å ´æ™¯çš„é‡è¦å¯¦è¸ã€‚

:anchor

## æ­£å‰‡è¡¨é”å¼ï¼ˆRegular Expressionï¼‰

![æ­£å‰‡è¡¨é”å¼](/img/articles/eloquent-JavaScript/9.æ­£å‰‡è¡¨é”å¼.svg)

#### 1. ä»€éº¼æ˜¯æ­£å‰‡è¡¨é”å¼ï¼Ÿ

æ­£å‰‡è¡¨é”å¼ï¼ˆRegular Expressionï¼‰æ˜¯ä¸€ç¨®æè¿°æ–‡å­—æ¨¡å¼çš„èªæ³•ï¼Œç”¨æ–¼åœ¨å­—ä¸²ä¸­æœå°‹ã€åŒ¹é…å’Œæ“ä½œæ–‡å­—ã€‚å®ƒç”±ä¸€å€‹æˆ–å¤šå€‹å­—å…ƒçµ„æˆï¼Œå¯ä»¥è¡¨ç¤ºç‰¹å®šçš„æ–‡å­—æ¨¡å¼ï¼Œå¦‚å–®ä¸€å­—å…ƒã€å­—å…ƒé›†åˆã€å­—å…ƒç¯„åœã€å¯é¸å­—å…ƒã€é‡è¤‡å­—å…ƒç­‰ã€‚æ­£å‰‡è¡¨é”å¼å¸¸è¢«ç”¨æ–¼æ–‡å­—è™•ç†ã€è³‡æ–™é©—è­‰ã€å­—ä¸²æ“ä½œç­‰å ´æ™¯ã€‚

#### 2. å¦‚ä½•å‰µå»ºæ­£å‰‡è¡¨é”å¼ï¼Ÿ

```javascript
let re1 = new RegExp("abc");
let re2 = /abc/;
```

1. RegExp æ§‹é€ å‡½æ•¸
2. å­—é¢é‡è¡¨ç¤ºæ³•
    ```javascript
    let aPlus = /A\+/;  // è¡¨ç¤ºå­—å…ƒæœ¬èº«ï¼Œéœ€åœ¨å­—å…ƒå‰åŠ å…¥åæ–œç·š\
    ```

#### 3. æ¸¬è©¦åŒ¹é…ï¼ˆTest Methodï¼‰

æ­£å‰‡è¡¨é”å¼çš„ `test` æ–¹æ³•ç”¨æ–¼æª¢æŸ¥å­—ä¸²ä¸­æ˜¯å¦åŒ…å«èˆ‡æ­£å‰‡è¡¨é”å¼ç›¸åŒ¹é…çš„å­å­—ä¸²ï¼Œä¸¦è¿”å›å¸ƒæ—å€¼ã€‚å¦‚æœæ‰¾åˆ°åŒ¹é…ï¼Œå‰‡è¿”å› `true`ï¼Œå¦å‰‡è¿”å› `false`ã€‚

```javascript
console.log(/abc/.test("abcde"));
// â†’ true
console.log(/abc/.test("abxde"));
// â†’ false
```

## å­—å…ƒé›†åˆï¼ˆCharacter Classesï¼‰

![å­—å…ƒé›†åˆ](/img/articles/eloquent-JavaScript/9.å­—å…ƒé›†åˆ.svg)

#### 1. ä»€éº¼æ˜¯å­—å…ƒé›†åˆï¼Ÿ

æ­£å‰‡è¡¨é”å¼ä¸­çš„å­—å…ƒé›†åˆç”¨æ–¼åŒ¹é…ç‰¹å®šç¯„åœæˆ–é›†åˆçš„å­—å…ƒã€‚å®ƒå€‘é€šå¸¸ç”¨æ–¹æ‹¬è™Ÿ `[]` åŒ…è£¹ï¼Œä¸¦åŒ…å«è¦åŒ¹é…çš„å­—å…ƒæˆ–ç¯„åœã€‚

#### 2. å¦‚ä½•ä½¿ç”¨å­—å…ƒé›†åˆï¼Ÿ

å­—å…ƒé›†åˆå¯ä»¥åŒ…å«å–®å€‹å­—å…ƒæˆ–å­—å…ƒç¯„åœã€‚ç¯„åœä½¿ç”¨é€£å­—å…ƒ `-` è¡¨ç¤ºï¼Œä¾‹å¦‚ `[0-9]` è¡¨ç¤ºæ‰€æœ‰æ•¸å­—å­—å…ƒï¼ˆUnicode ç·¨ç¢¼ 48ï½57ï¼‰ã€‚ç¯„åœçš„æ’åºç”±å­—å…ƒçš„ Unicode ç·¨ç¢¼æ±ºå®šã€‚ä»¥ä¸‹å…©å€‹è¡¨é”å¼éƒ½åŒ¹é…åŒ…å«æ•¸å­—çš„æ‰€æœ‰å­—ä¸²ï¼š

```javascript
console.log(/[0123456789]/.test("in 1992"));
// â†’ true
console.log(/[0-9]/.test("in 1992"));
// â†’ true
```

#### 3. ç‰¹æ®Šå­—å…ƒé›†åˆ

æ­£å‰‡è¡¨é”å¼ä¸­æœ‰ä¸€äº›ç‰¹æ®Šå­—å…ƒé›†åˆï¼Œç”¨æ–¼åŒ¹é…ç‰¹å®šé¡å‹çš„å­—å…ƒï¼Œåªæœ‰åæ–œç·šä»£ç¢¼å¯ç”¨åœ¨æ–¹æ‹¬è™Ÿ `[]`ä¸­ã€‚ä¾‹å¦‚ï¼š

- `\d`ï¼šä»»ä½•æ•¸å­—å­—å…ƒï¼ˆç­‰åŒæ–¼ `[0-9]`ï¼‰
- `\w`ï¼šä»»ä½•å–®è©å­—å…ƒï¼ˆå­—æ¯ã€æ•¸å­—æˆ–ä¸‹åŠƒç·šï¼‰
- `\s`ï¼šä»»ä½•ç©ºç™½å­—å…ƒï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ›è¡Œå­—å…ƒç­‰ï¼‰
- `\D`ï¼šä»»ä½•éæ•¸å­—å­—å…ƒï¼ˆç­‰åŒæ–¼ `[^0-9]`ï¼‰
- `\W`ï¼šä»»ä½•éå–®è©å­—å…ƒï¼ˆç­‰åŒæ–¼ `[^a-zA-Z0-9_]`ï¼‰
- `\S`ï¼šä»»ä½•éç©ºç™½å­—å…ƒï¼ˆç­‰åŒæ–¼ `[^ \t\n\r\f]`ï¼‰
- `.`ï¼šä»»ä½•å–®å€‹å­—å…ƒï¼ˆé™¤äº†æ›è¡Œå­—å…ƒ `\n`ï¼‰ï¼Œä½†åœ¨æ–¹æ‹¬è™Ÿ `[]` å…§è¡¨ç¤ºå­—é¢ä¸Šçš„å¥é»ã€‚
  ```javascript
  let dot = /./;
  console.log(dot.test("bearune"));
  // â†’ true
  let dotInBracket = /[.]/;
  console.log(dotInBracket.test("bearune"));
  // â†’ false
  console.log(dotInBracket.test("bearune."));
  // â†’ true
  ```
  

##### ç¯„ä¾‹

æˆ‘å€‘å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¡¨é”å¼åŒ¹é… `01-30-2003 15:20` æ ¼å¼çš„æ—¥æœŸå’Œæ™‚é–“ï¼š

```javascript
let dateTime = /\d\d-\d\d-\d\d\d\d \d\d:\d\d/;
console.log(dateTime.test("01-30-2003 15:20"));
// â†’ true
console.log(dateTime.test("30-jan-2003 15:20"));
// â†’ false
```

ä¹çœ‹ä¹‹ä¸‹ `\d` éå¸¸å¤šä¸”ä¸æ˜“è®€ï¼Œä½†å…¶å¯¦é€™å€‹ç¯„ä¾‹æœ‰æ›´å¥½çš„è¡¨ç¤ºæ–¹æ³•ï¼Œä¸‹é¢[é‡è¤‡æ¨¡å¼](#_2-å¦‚ä½•ä½¿ç”¨é‡è¤‡æ¨¡å¼)æœƒæåˆ°ã€‚

#### 4. åè½‰å­—å…ƒ

å¦‚æœåœ¨æ–¹æ‹¬è™Ÿ `[]` ä¸­ä½¿ç”¨ `^` å­—å…ƒï¼Œè¡¨ç¤ºåè½‰å­—å…ƒé›†åˆï¼Œå³åŒ¹é…ä¸åœ¨æ–¹æ‹¬è™Ÿå…§çš„å­—å…ƒã€‚ä¾‹å¦‚ï¼Œ`[^01]` è¡¨ç¤ºåŒ¹é…ä»»ä½• 0 èˆ‡ 1 ä»¥å¤–çš„å­—å…ƒã€‚

```javascript
let nonBinary = /[^01]/;
console.log(nonBinary.test("1100100010100110"));
// â†’ false
console.log(nonBinary.test("0111010112101001"));
// â†’ true
```

#### 5. åœ‹éš›å­—å…ƒ

ç”±æ–¼ JavaScript ç•¶åˆä¸¦æ²’æœ‰è€ƒæ…®åˆ°æ­£å‰‡è¡¨é”å¼çš„åœ‹éš›åŒ–éœ€æ±‚ï¼Œå› æ­¤åœ¨ Unicode å­—å…ƒä¸Šå­˜åœ¨ä¸€äº›å•é¡Œã€‚è­¬å¦‚ `\w` è¡¨ç¤ºå–®è©å­—å…ƒï¼Œä½†ä¸åŒ…æ‹¬éæ‹‰ä¸å­—æ¯çš„å­—å…ƒï¼Œå¦‚æ—¥æ–‡ã€ä¸­æ–‡ç­‰ã€‚

ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œï¼ŒES9 å¼•å…¥äº† `\p{}` å’Œ `\P{}` ä¾†è¡¨ç¤º Unicode å±¬æ€§ï¼Œä¸¦ä¸”å› ç‚ºå…¼å®¹æ€§å•é¡Œï¼Œéœ€åœ¨æ­£å‰‡è¡¨é”å¼å¾Œæ·»åŠ  `u` å­—å…ƒã€‚

- `\p{}`ï¼šåŒ¹é…**å…·æœ‰**æŒ‡å®š Unicode å±¬æ€§çš„å­—å…ƒ
- `\P{}`ï¼šåŒ¹é…**ä¸å…·æœ‰**æŒ‡å®š Unicode å±¬æ€§çš„å­—å…ƒ

ä¸‹ä¾‹ä½¿ç”¨ `\p{Script=Han}` è¡¨ç¤ºåŒ¹é…æ‰€æœ‰æ¼¢å­—å­—å…ƒã€‚

```javascript
let han = /\p{Script=Han}/u;
console.log(han.test("ç†Šé€”"));
// â†’ true
let notHan = /\P{Script=Han}/u;
console.log(notHan.test("ç†Šé€”"));
// â†’ false
```

## é‡è¤‡æ¨¡å¼ï¼ˆRepetitionï¼‰

![é‡è¤‡æ¨¡å¼](/img/articles/eloquent-JavaScript/9.é‡è¤‡æ¨¡å¼.svg)

#### 1. ä»€éº¼æ˜¯é‡è¤‡æ¨¡å¼ï¼Ÿ

é‡è¤‡æ¨¡å¼ç”¨æ–¼æŒ‡å®šåŒ¹é…å­—å…ƒæˆ–å­—å…ƒé›†åˆçš„æ¬¡æ•¸ã€‚ä¾‹å¦‚ï¼šæˆ‘å€‘æƒ³è¦åŒ¹é…ä¸€å€‹æˆ–å¤šå€‹æ•¸å­—çš„åºåˆ—ï¼Œå¯ä»¥ä½¿ç”¨ `\d+` è¡¨ç¤ºï¼š

``` javascript
console.log(/'\d+'/.test("'123'"));
// â†’ true
console.log(/'\d+'/.test("''"));
// â†’ false
```

#### 2. å¦‚ä½•ä½¿ç”¨é‡è¤‡æ¨¡å¼ï¼Ÿ

é‡è¤‡æ¨¡å¼å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç¬¦è™Ÿè¡¨ç¤ºï¼š

- `+`ï¼š 1 æ¬¡æˆ–å¤šæ¬¡
- `*`ï¼š 0 æ¬¡æˆ–å¤šæ¬¡

```javascript
// + èˆ‡ * çš„å·®ç•°
console.log(/'\d+'/.test("'123'"));
// â†’ true
console.log(/'\d+'/.test("''"));
// â†’ false
console.log(/'\d*'/.test("'123'"));
// â†’ true
console.log(/'\d*'/.test("''"));
// â†’ true
```

- `?`ï¼š 0 æ¬¡æˆ– 1 æ¬¡

```javascript
// u å­—å…ƒå¯ä»¥å‡ºç¾ä¹Ÿå¯ä»¥ç¼ºå¤±
let neighbor = /neighbou?r/;
console.log(neighbor.test("neighbour"));
// â†’ true
console.log(neighbor.test("neighbor"));
// â†’ true
```

- `{n}`ï¼š ç²¾ç¢ºé‡è¤‡ n æ¬¡
- `{n,m}`ï¼š é‡è¤‡ n åˆ° m æ¬¡
- `{n,}`ï¼š è‡³å°‘é‡è¤‡ n æ¬¡

```javascript
let dateTime = /\d{1,2}-\d{1,2}-\d{4} \d{1,2}:\d{2}/;
console.log(dateTime.test("1-30-2003 8:45"));
// â†’ true
```

#### 3. è²ªå©ªèˆ‡éè²ªå©ªåŒ¹é…

##### 3.1 è²ªå©ªåŒ¹é…ï¼ˆGreedyï¼‰

é è¨­æƒ…æ³ä¸‹ï¼Œé‡è¤‡é‹ç®—å­ï¼ˆ`+`ã€`*`ã€`?`ã€`{}`ï¼‰æœƒç›¡å¯èƒ½åŒ¹é…æœ€å¤šçš„å­—å…ƒã€‚ä»¥ä¸‹æ˜¯ä¸€å€‹ç§»é™¤ JavaScript è¨»é‡‹çš„ä¾‹å­ï¼š

```javascript
function stripComments(code) {
  return code.replace(/\/\/.*|\/\*[^]*\*\//g, "");
}
console.log(stripComments("1 + /* 2 */3"));
// â†’ 1 + 3
console.log(stripComments("x = 10;// ten!"));
// â†’ x = 10;
console.log(stripComments("1 /* a */+/* b */ 1"));
// â†’ 1  1
```

é€™å€‹å‡½æ•¸çš„ç›®çš„å¾ˆç°¡å–®ï¼šæŠŠç¨‹å¼ç¢¼ä¸­çš„è¨»é‡‹éƒ½æ¸…æ‰ã€‚è¨»é‡‹æœ‰å…©ç¨®ï¼š

1. å–®è¡Œè¨»é‡‹ï¼šä»¥ `//` é–‹é ­åˆ°è¡Œå°¾çš„å…§å®¹
2. å¤šè¡Œè¨»é‡‹ï¼šè¢« `/*` å’Œ `*/` åŒ…èµ·ä¾†çš„å…§å®¹

ä½†æ˜¯æœ€å¾Œä¸€å€‹ä¾‹å­å‡ºç¾äº†å¥‡æ€ªçš„çµæœï¼åŸæœ¬æ‡‰è©²æ˜¯ `1 + 1`ï¼Œå»è®Šæˆäº† `1  1`ã€‚é€™æ˜¯ç‚ºä»€éº¼å‘¢ï¼Ÿ

å•é¡Œå‡ºåœ¨æ­£å‰‡è¡¨é”å¼å¤ªã€Œè²ªåƒã€äº†ã€‚ç•¶å®ƒçœ‹åˆ° `/* a */+/* b */` é€™æ®µæ™‚ï¼Œå®ƒä¸æ˜¯ä¹–ä¹–åœ°åˆ†åˆ¥åƒæ‰å…©å€‹è¨»é‡‹ï¼Œè€Œæ˜¯æ•´æ®µéƒ½åä¸‹å»ï¼å› ç‚ºæˆ‘å€‘ç”¨äº† `[^]*` é€™å€‹æ¨¡å¼ï¼Œå®ƒçš„æ„æ€æ˜¯ã€Œåƒæ‰æ‰€æœ‰èƒ½åƒçš„æ±è¥¿ï¼Œç›´åˆ°çœ‹åˆ°æœ€å¾Œä¸€å€‹ `*/`ã€ï¼Œå…·é«”åŸç†å¯åƒè€ƒä¸‹æ–¹[å›æº¯æ©Ÿåˆ¶](#_2-åŒ¹é…æ©Ÿåˆ¶)ã€‚

ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œï¼Œæˆ‘å€‘å°±å¿…é ˆä½¿ç”¨éè²ªå©ªåŒ¹é…ã€‚

##### 3.2 éè²ªå©ªåŒ¹é…ï¼ˆNon-greedyï¼‰

å¦‚æœæˆ‘å€‘å¸Œæœ›é‡è¤‡é‹ç®—å­ç›¡å¯èƒ½åŒ¹é…æœ€å°‘çš„å­—å…ƒï¼Œå¯ä»¥ä½¿ç”¨ `?` ä¾†è¡¨ç¤ºéè²ªå©ªåŒ¹é…ã€‚ä»¥ä¸‹æ˜¯å‰›æ‰çš„ä¾‹å­ï¼š

```javascript
function stripComments(code) {
  return code.replace(/\/\/.*|\/\*[^]*?\*\//g, "");
}
console.log(stripComments("1 /* a */+/* b */ 1"));
// â†’ 1 + 1
```

é€™æ¨£å°±èƒ½è®“ `[^]*` åŒ¹é…åˆ°æœ€è¿‘çš„ `*/` ï¼Œä¸¦è¼¸å‡ºé æœŸçš„çµæœäº†ã€‚

## æ­£å‰‡è¡¨é”å¼é¸é …
![é¸é …æ¨¡å¼](/img/articles/eloquent-JavaScript/9.é¸é …æ¨¡å¼.svg)

æ­£å‰‡è¡¨é”å¼å¯ä»¥ä½¿ç”¨é¸é …ä¾†ä¿®æ”¹å…¶è¡Œç‚ºã€‚ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„é¸é …ï¼š

#### 1. iï¼ˆignore caseï¼‰

`i` èƒ½ä½¿åŒ¹é…ä¸å€åˆ†å¤§å°å¯«ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```javascript
let pattern = /hello/i;
console.log(pattern.test("Hello"));  // â†’ true
console.log(pattern.test("HELLO"));  // â†’ true
```

#### 2. gï¼ˆglobalï¼‰

`g` ç‚ºå…¨å±€åŒ¹é…ï¼ŒæŸ¥æ‰¾æ‰€æœ‰åŒ¹é…é …è€Œä¸æ˜¯åªæ‰¾ç¬¬ä¸€å€‹åŒ¹é…é …ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```javascript
"banana".match(/an/g);  // â†’ ['an', 'an']
"banana".replace(/an/g, "AN");  // â†’ "bANANa"
```

#### 3. yï¼ˆstickyï¼‰

`y` ç‚ºé»æ€§åŒ¹é…ï¼Œåªå¾ `lastIndex` ä½ç½®é–‹å§‹åŒ¹é…ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```javascript
let sticky = /abc/y;
sticky.lastIndex = 3;
console.log(sticky.test("123abc"));  // â†’ true
console.log(sticky.test("abc123"));  // â†’ false
```

#### 4. uï¼ˆunicodeï¼‰

`u` å•Ÿç”¨ Unicode æ¨¡å¼ï¼Œå…è¨±æ­£å‰‡è¡¨é”å¼ä½¿ç”¨ Unicode å­—å…ƒï¼Œä¸¦ä½¿ `\p{...}` èªæ³•ç”Ÿæ•ˆï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```javascript
console.log(/\p{L}/u.test("Î±"));  // â†’ true
console.log(/\p{Script=Greek}/u.test("Î±"));  // â†’ true
console.log(/ğŸ{3}/u.test("ğŸğŸğŸ"));  // â†’ true
```

## åˆ†çµ„åŸºç¤

![åˆ†çµ„åŸºç¤](/img/articles/eloquent-JavaScript/9.åˆ†çµ„åŸºç¤.svg)

#### 1. ä»€éº¼æ˜¯åˆ†çµ„ï¼Ÿ

åœ¨æ­£å‰‡è¡¨é”å¼ä¸­ï¼Œæ‹¬è™Ÿ `()` ç”¨æ–¼å‰µå»ºä¸€å€‹åˆ†çµ„ï¼Œä½¿å¾—æ‹¬è™Ÿå…§çš„æ¨¡å¼ä½œç‚ºä¸€å€‹æ•´é«”è¢«è™•ç†ã€‚é€™å°æ–¼ä»¥ä¸‹æƒ…æ³ç‰¹åˆ¥æœ‰ç”¨ï¼š

##### ç¯„ä¾‹ï¼šå°‡å¤šå€‹å…ƒç´ ä½œç‚ºä¸€å€‹æ•´é«”æ‡‰ç”¨é‡è¤‡é‹ç®—å­

```javascript
let cartoonCrying = /boo+(hoo+)+/i;
console.log(cartoonCrying.test("Boohoooohoohooo"));
// â†’ true
```

- ç¬¬ä¸€å€‹åŠç¬¬äºŒå€‹ `+` åˆ†åˆ¥æ‡‰ç”¨æ–¼ `boo` åŠ `hoo` ä¸­çš„ `o`ã€‚
- ç¬¬ä¸‰å€‹ `+` æ‡‰ç”¨æ–¼æ•´å€‹ `(hoo+)` çµ„ã€‚
- è¡¨é”å¼æœ«å°¾çš„ `i` ä½¿åŒ¹é…ä¸å€åˆ†å¤§å°å¯«ã€‚

#### 2. éæ•ç²åˆ†çµ„

å¦‚æœåªæƒ³ä½¿ç”¨æ‹¬è™Ÿé€²è¡Œåˆ†çµ„ï¼Œä½†ä¸å¸Œæœ›å®ƒå‡ºç¾åœ¨åŒ¹é…çµæœä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `(?:)` èªæ³•ï¼š

```javascript
// ä½¿ç”¨éæ•ç²åˆ†çµ„
console.log(/(?:na)+/.exec("banana"));
// â†’ ["nana"]

// å°æ¯”ä½¿ç”¨æ•ç²åˆ†çµ„
console.log(/(na)+/.exec("banana"));
// â†’ ["nana", "na"]
```

## åˆ†çµ„èˆ‡åŒ¹é…çµæœ

`test` æ–¹æ³•åªæä¾›ã€Œæ˜¯å¦åŒ¹é…ã€çš„çµæœï¼Œæ˜¯æ­£å‰‡è¡¨é”å¼ä¸­æœ€ç°¡å–®çš„æ–¹æ³•ï¼Œä»¥ä¸‹æ–¹æ³•æä¾›æ›´è©³ç´°çš„åŒ¹é…çµæœï¼Œä¾‹å¦‚ï¼š

#### 1. exec æ–¹æ³•

`exec` æ–¹æ³•æ˜¯æ­£å‰‡è¡¨é”å¼çš„ä¸€å€‹å¼·å¤§æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€å€‹åŒ…å«åŒ¹é…ä¿¡æ¯çš„ç‰©ä»¶ï¼š

```javascript
let match = /\d+/.exec("one two 100");
console.log(match);
// â†’ ["100"]
console.log(match.index);  // åŒ¹é…é–‹å§‹çš„ä½ç½®
// â†’ 8
```

1. å¦‚æœæ²’æœ‰æ‰¾åˆ°åŒ¹é…ï¼Œè¿”å› `null`
2. å¦‚æœæ‰¾åˆ°åŒ¹é…ï¼Œè¿”å›ä¸€å€‹é¡é™£åˆ—ç‰©ä»¶(Array-like Object)ï¼ŒåŒ…å«ï¼š
     - é™£åˆ—ç¬¬ä¸€é …æ˜¯å®Œæ•´çš„åŒ¹é…å­—ä¸²
     - é™£åˆ—å…¶ä»–é …æ˜¯å„å€‹åˆ†çµ„åŒ¹é…çš„å…§å®¹
     - `index` å±¬æ€§è¡¨ç¤ºåŒ¹é…é–‹å§‹çš„ä½ç½®

##### 1.1 åˆ†çµ„åŒ¹é…

å°å«æœ‰åˆ†çµ„åŒ¹é…çš„è¡¨é”å¼ï¼Œ`exec` æ–¹æ³•æœƒè¿”å›ä¸€å€‹åŒ…å«åŒ¹é…å­—ä¸²åŠå„å€‹åˆ†çµ„åŒ¹é…å…§å®¹çš„é™£åˆ—ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```javascript
let quotedText = /'([^']*)'/;
```

1. å¤–å±¤çš„å–®å¼•è™Ÿ `'`ï¼šåŒ¹é…çš„æ–‡æœ¬å¿…é ˆä»¥å–®å¼•è™Ÿé–‹å§‹å’ŒçµæŸã€‚
2. æ•ç²çµ„ `([^']*)`
   - `(` å’Œ `)`ï¼šé€™å°æ‹¬è™Ÿè¡¨ç¤ºä¸€å€‹æ•ç²çµ„ï¼Œå®ƒå°‡åŒ¹é…çš„å…§å®¹ä¿å­˜åœ¨çµæœä¸­ï¼Œæ–¹ä¾¿å¾ŒçºŒå¼•ç”¨ï¼Œè©³è¦‹[åˆ†çµ„èˆ‡å¼•ç”¨](#åˆ†çµ„èˆ‡å¼•ç”¨groups-and-references)ã€‚
   - `[^']`ï¼šè¡¨ç¤ºåŒ¹é…ä»»ä½•ä¸æ˜¯å–®å¼•è™Ÿçš„å­—å…ƒã€‚`^` åœ¨é–‹é ­è¡¨ç¤ºå¦å®šï¼Œè©³è¦‹[åè½‰å­—å…ƒ](#ç¯„ä¾‹)ã€‚
   - `*`ï¼šé€™å€‹é‡è©è¡¨ç¤ºå‰é¢çš„å…ƒç´ ï¼ˆå³ `[^']`ï¼‰å¯ä»¥å‡ºç¾é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚å¯ä»¥åŒ¹é…ç©ºå­—å…ƒä¸²æˆ–å¤šå€‹éå–®å¼•è™Ÿå­—å…ƒï¼Œè©³è¦‹[é‡è¤‡æ¨¡å¼](#é‡è¤‡æ¨¡å¼repetition)ã€‚

é€™å€‹æ­£å‰‡è¡¨é”å¼çš„æ•´é«”éœ€æ±‚æ˜¯ï¼š  
å®ƒå°‡åŒ¹é…ä¸€æ®µæ–‡æœ¬ï¼Œè©²æ–‡æœ¬æ˜¯ç”±å–®å¼•è™Ÿ `'` åŒ…åœçš„ï¼Œä¸¦ä¸”åœ¨å–®å¼•è™Ÿå…§å¯ä»¥åŒ…å«ä»»æ„æ•¸é‡çš„éå–®å¼•è™Ÿå­—å…ƒã€‚

```javascript
console.log(quotedText.exec("she said 'hello'"));
// â†’ ["'hello'", "hello"]
```

##### 1.2 ç‰¹æ®Šæƒ…æ³

1. ç•¶ä¸€å€‹åˆ†çµ„æ²’æœ‰åŒ¹é…åˆ°å…§å®¹æ™‚ï¼ˆæ¯”å¦‚ä½¿ç”¨ `?` æ™‚ï¼‰ï¼Œå°æ‡‰ä½ç½®æœƒæ˜¯ `undefined`ã€‚
2. ç•¶ä¸€å€‹åˆ†çµ„è¢«å¤šæ¬¡åŒ¹é…æ™‚ï¼ˆæ¯”å¦‚ä½¿ç”¨ `+` æ™‚ï¼‰ï¼Œåªæœ‰æœ€å¾Œä¸€æ¬¡åŒ¹é…æœƒè¢«è¨˜éŒ„ã€‚

```javascript
console.log(/bad(ly)?/.exec("bad"));
// â†’ ["bad", undefined]

console.log(/(\d)+/.exec("123"));
// â†’ ["123", "3"]
```

##### 1.3 lastIndex

ç•¶æ­£å‰‡è¡¨é”å¼å•Ÿç”¨å…¨å±€ï¼ˆ`g`ï¼‰æˆ–é»æ€§ï¼ˆ`y`ï¼‰æ¨™èªŒæ™‚ï¼Œ`lastIndex` å±¬æ€§æœƒå½±éŸ¿ `exec` æ–¹æ³•çš„è¡Œç‚ºï¼š

1. `lastIndex` æ§åˆ¶ä¸‹ä¸€æ¬¡åŒ¹é…çš„èµ·å§‹ä½ç½®
2. åŒ¹é…æˆåŠŸæ™‚ï¼Œ`lastIndex` è‡ªå‹•æ›´æ–°ç‚ºåŒ¹é…çµæŸçš„ä½ç½®
3. åŒ¹é…å¤±æ•—æ™‚ï¼Œ`lastIndex` é‡ç½®ç‚º 0

```javascript
let pattern = /y/g;
pattern.lastIndex = 3;
let match = pattern.exec("xyzzy");
console.log(match.index);  // â†’ 4
console.log(pattern.lastIndex);  // â†’ 5
```

æ³¨æ„ï¼šåœ¨å¤šæ¬¡ä½¿ç”¨åŒä¸€å€‹æ­£å‰‡è¡¨é”å¼ç‰©ä»¶æ™‚ï¼Œ`lastIndex` çš„è‡ªå‹•æ›´æ–°å¯èƒ½å°è‡´æ„å¤–çµæœï¼š

```javascript
let digit = /\d/g;
console.log(digit.exec("here it is: 1"));  // â†’ ["1"]
console.log(digit.exec("and now: 1"));  // â†’ nullï¼Œå› ç‚º lastIndex æ²’æœ‰é‡ç½®
```

å› æ­¤ï¼Œç•¶ä½¿ç”¨å…¨å±€ï¼ˆ`g`ï¼‰æˆ–é»æ€§ï¼ˆ`y`ï¼‰æ¨™èªŒæ™‚ï¼Œå»ºè­°åœ¨æ¯æ¬¡ä½¿ç”¨å‰æ ¹æ“šéœ€è¦æ‰‹å‹•é‡ç½® `lastIndex` ç‚º `0`ã€‚è‹¥åªæ˜¯æƒ³æ‰¾å‡ºæ‰€æœ‰åŒ¹é…é …ï¼Œå¯ä»¥è€ƒæ…®ä½¿ç”¨ `match` æ–¹æ³•ï¼ˆåœ¨ä½¿ç”¨ `g` æ¨™èªŒæ™‚ï¼‰æˆ– `matchAll` æ–¹æ³•ï¼Œé€™æ¨£å¯ä»¥é¿å…æ‰‹å‹•è™•ç† `lastIndex` çš„å•é¡Œï¼Œé€™å…©å€‹æ–¹æ³•å°‡åœ¨ä¸‹é¢ä»‹ç´¹ã€‚

> åƒè€ƒè³‡æ–™ï¼š[RegExp.prototype.exec() - JavaScript - MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec){target=_blank}

#### 2. match æ–¹æ³•

å­—ä¸²çš„ `match` æ–¹æ³•èˆ‡æ­£å‰‡è¡¨é”å¼çš„ `exec` æ–¹æ³•é¡ä¼¼ï¼Œä½†æœ‰ä¸€äº›é‡è¦å€åˆ¥ï¼š

```javascript
let match = "one two 100 200".match(/\d+/);
console.log(match);  // åªåŒ¹é…ç¬¬ä¸€å€‹åŒ¹é…çš„å­—ä¸²ï¼Œèˆ‡ exec æ–¹æ³•ç›¸åŒ
// â†’ ["100"]
```

##### 2.1 å…¨å±€æœç´¢æ™‚çš„è¡Œç‚ºå·®ç•°

ä½¿ç”¨ `g` æ¨™èªŒæ™‚ï¼Œ`match` æœƒè¿”å›æ‰€æœ‰åŒ¹é…é …çš„æ•¸çµ„ï¼Œè€Œä¸æ˜¯åƒ `exec` é‚£æ¨£åªè¿”å›ç¬¬ä¸€å€‹åŒ¹é…çš„è©³ç´°ä¿¡æ¯ã€‚

```javascript
console.log("Banana".match(/an/));
// â†’ ["an"]

console.log("Banana".match(/an/g));
// â†’ ["an", "an"]

console.log(/an/.exec("Banana"));
// â†’ ["an"]

```

##### 2.2 ä½¿ç”¨å»ºè­°

- å¦‚æœéœ€è¦ç²å–åˆ†çµ„ä¿¡æ¯æˆ–ç²¾ç¢ºçš„åŒ¹é…ä½ç½®ï¼Œä½¿ç”¨ `exec`ã€‚
- å¦‚æœåªéœ€è¦ç²å–æ‰€æœ‰åŒ¹é…çš„å­—ä¸²ï¼Œä½¿ç”¨å¸¶æœ‰ `g` æ¨™èªŒçš„ `match`ã€‚

> åƒè€ƒè³‡æ–™ï¼š[String.prototype.match() - JavaScript - MDN Web Docs](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/match){target=_blank}

#### 3. matchAll æ–¹æ³•ï¼ˆES2020+ï¼‰

å¦‚æœéœ€è¦ç²å–æ‰€æœ‰åŒ¹é…çš„è©³ç´°ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨å­—ä¸²çš„ `matchAll` æ–¹æ³•ï¼š

```javascript
let input = "A string with 3 numbers in it... 42 and 88.";
let matches = input.matchAll(/\d+/g);
for (let match of matches) {
  console.log("Found", match[0], "at", match.index);
}
// â†’ Found 3 at 14
// â†’ Found 42 at 33
// â†’ Found 88 at 40
```

- ä½¿ç”¨ `matchAll` æ™‚ï¼Œæ­£å‰‡è¡¨é”å¼å¿…é ˆåŒ…å« `g` æ¨™èªŒã€‚

> åƒè€ƒè³‡æ–™ï¼š[String.prototype.matchAll() - JavaScript - MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/matchAll){target=_blank}

#### 4. æ¯”è¼ƒ

| æ–¹æ³•       | è¿”å›å€¼é¡å‹        | å…¨åŸŸæœå°‹        | æ•ç²çµ„è™•ç† | ç‰¹é»                                                                                              |
| ---------- | ----------------- | --------------- | ---------- | ------------------------------------------------------------------------------------------------- |
| exec()     | `Array` æˆ– `null` | éœ€æ‰‹å‹•è¿­ä»£      | å®Œæ•´æ”¯æ´   | - è¿”å›å–®æ¬¡åŒ¹é…çµæœå’Œè©³ç´°è³‡è¨Š<br>- ä¿ç•™ `lastIndex`<br>- éœ€ä½¿ç”¨ `g` æ¨™èªŒä¸¦é‡è¤‡èª¿ç”¨æ‰èƒ½ç²å–æ‰€æœ‰åŒ¹é… |
| match()    | `Array` æˆ– `null` | è‡ªå‹•ï¼ˆæœ‰`g`æ™‚ï¼‰ | æœ‰é™æ”¯æ´   | - ç„¡ `g`ï¼šè¿”å›é¦–æ¬¡åŒ¹é…å’Œæ•ç²çµ„<br>- æœ‰ `g`ï¼šè¿”å›æ‰€æœ‰åŒ¹é…ä½†ä¸å«æ•ç²çµ„                              |
| matchAll() | `Iterator`        | è‡ªå‹•            | å®Œæ•´æ”¯æ´   | - è¿”å›åŒ…å«æ‰€æœ‰åŒ¹é…è³‡è¨Šçš„è¿­ä»£å™¨<br>- å¿…é ˆä½¿ç”¨ `g` æ¨™èªŒ<br>- å¯ç”¨ `for...of` éæ­·                   |


```javascript
const str = "cat, bat, sat, fat";
const regex = /([a-z])at/g;

// exec() - éœ€è¦å¾ªç’°ç²å–æ‰€æœ‰åŒ¹é…
let result;
while ((result = regex.exec(str)) !== null) {
    console.log(result);
}
// â†’ ["cat","c"]
// â†’ ["bat","b"]
// â†’ ["sat","s"]
// â†’ ["fat","f"]

// match() - æœ‰ /g æ™‚åªè¿”å›å®Œæ•´åŒ¹é…
console.log(str.match(regex));
// â†’ ["cat", "bat", "sat", "fat"]

// matchAll() - è¿”å›å®Œæ•´è³‡è¨Šçš„è¿­ä»£å™¨
const matches = [...str.matchAll(regex)];
console.log(matches);
// â†’ [["cat","c"], ["bat","b"], ["sat","s"], ["fat","f"]]
```

## å­—ä¸²æ–¹æ³•

![å­—ä¸²æ–¹æ³•](/img/articles/eloquent-JavaScript/9.å­—ä¸²æ–¹æ³•.svg)

ä»¥ä¸‹ä»‹ç´¹å…©å€‹å¯ä»¥ä½¿ç”¨æ­£å‰‡è¡¨é”å¼çš„å­—ä¸²æ–¹æ³•ï¼š`replace` å’Œ `split`ã€‚

#### 1. replace æ–¹æ³•

##### 1.1 å¦‚ä½•ä½¿ç”¨ replace æ–¹æ³•ï¼Ÿ

`replace` æ–¹æ³•ç”¨æ–¼åœ¨å­—ä¸²ä¸­æ›¿æ›åŒ¹é…çš„å­—ä¸²ã€‚å®ƒæ¥å—å…©å€‹åƒæ•¸ï¼š`è¦æ›¿æ›çš„å­—ä¸²`æˆ–`æ­£å‰‡è¡¨é”å¼`ï¼Œä»¥åŠ`æ›¿æ›çš„å…§å®¹`ã€‚ç•¶åœ¨æ­£å‰‡è¡¨é”å¼ä¹‹å¾Œæ·»åŠ  `g` é¸é …ï¼Œé‚„èƒ½æ›¿æ›æ‰€æœ‰åŒ¹é…é …ã€‚

```javascript
let str = "cat, cat, cat";

// åªæ›¿æ›ç¬¬ä¸€å€‹åŒ¹é…
console.log(str.replace("cat", "dog"));  // â†’ "dog, cat, cat"
console.log(str.replace(/cat/, "dog"));  // â†’ "dog, cat, cat"
// ä½¿ç”¨æ­£å‰‡æ›¿æ›æ‰€æœ‰åŒ¹é…
console.log(str.replace(/cat/g, "dog")); // â†’ "dog, dog, dog"
```

##### 1.2 åˆ†çµ„åŒ¹é…

`replace` æ–¹æ³•é‚„æ”¯æŒåˆ†çµ„åŒ¹é…ï¼Œå…è¨±åœ¨æ›¿æ›å…§å®¹ä¸­å¼•ç”¨åŒ¹é…çš„å­å­—ä¸²ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

```javascript
console.log(
  "Liskov, Barbara\nMcCarthy, John\nMilner, Robin"
    .replace(/(\p{L}+), (\p{L}+)/gu, "$2 $1"));
// â†’ "Barbara Liskov
//   John McCarthy
//   Robin Milner"
```

æ›¿æ›å­—å…ƒä¸­çš„ `$1`ã€`$2` æŒ‡çš„æ˜¯è¦æ›¿æ›è¡¨é”å¼çš„åˆ†çµ„ï¼Œè¡¨ç¤ºç‚º `$n`ï¼Œå…¶ä¸­ `n` ç‚ºå°æ–¼ 100 çš„æ­£æ•´æ•¸ï¼›`$&` å‰‡è¡¨ç¤ºæ•´å€‹åŒ¹é…ã€‚

```javascript
console.log("javascript".replace(/.*/, "$&$&"));  // â†’ "javascriptjavascript"
```

> åƒè€ƒè³‡æ–™ï¼š[String.prototype.replace() - JavaScript - MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace){target=_blank}

#### 2. search æ–¹æ³•

##### 2.1 å¦‚ä½•ä½¿ç”¨ search æ–¹æ³•ï¼Ÿ

èˆ‡å­—ä¸²çš„ `indexOf` ç›¸ä¼¼ï¼Œç”¨æ–¼å­—ä¸²ä¸­åŸ·è¡Œæ­£å‰‡è¡¨é”å¼çš„æœç´¢ï¼Œä¸¦è¿”å›é¦–æ¬¡åŒ¹é…ä½ç½®ï¼›å¦‚æœæœªæ‰¾åˆ°åŒ¹é…ï¼Œå‰‡è¿”å› `-1`ã€‚

```javascript
const str = "Hello World";
console.log(str.search(/World/));  // â†’ 6
console.log(str.search(/javascript/));  // â†’ -1
```

##### 2.2 èˆ‡ indexOf çš„å€åˆ¥

`search` æ–¹æ³•èˆ‡ `indexOf` çš„ä¸»è¦å€åˆ¥åœ¨æ–¼ï¼Œ`search` æ–¹æ³•æ¥å—æ­£å‰‡è¡¨é”å¼ä½œç‚ºåƒæ•¸ï¼Œè€Œ `indexOf` æ–¹æ³•å‰‡æ¥å—å­—ä¸²ä½œç‚ºåƒæ•¸ã€‚

```javascript
const str = "Hello World";
// indexOf åªèƒ½æœç´¢å›ºå®šå­—ä¸²
console.log(str.indexOf("World"));  // â†’ 6

// search å¯ä»¥ä½¿ç”¨æ­£å‰‡è¡¨é”å¼
console.log(str.search(/W\w+/));  // â†’ 6
```

> åƒè€ƒè³‡æ–™ï¼š[String.prototype.search() - JavaScript - MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/search){target=_blank}

## é‚Šç•Œå’Œå‰ç»

![é‚Šç•Œèˆ‡å‰ç»](/img/articles/eloquent-JavaScript/9.é‚Šç•Œèˆ‡å‰ç».svg)

ä¸‹é¢æ˜¯ä¸€å€‹ä»¥å­—ä¸²å‰µå»ºæ—¥æœŸçš„ç‰©ä»¶ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨æ­£å‰‡è¡¨é”å¼ä¾†è§£ææ—¥æœŸå­—ä¸²ä¸¦è¿”å›ä¸€å€‹ `Date` ç‰©ä»¶ï¼š

```javascript
function getDate(string) {
  let [_, month, day, year] =
    /(\d{1,2})-(\d{1,2})-(\d{4})/.exec(string);
  return new Date(year, month - 1, day);
}
console.log(getDate("1-30-2003"));
// â†’ Thu Jan 30 2003 00:00:00 GMT+0100 (CET)
```

é›–ç„¶çœ‹ä¼¼å¾ˆæ­£å¸¸ï¼Œä½† `getDate` ä¹Ÿèƒ½å¾å­—ä¸² `100-1-30000` ä¸­æå–æ—¥æœŸï¼Œé€™ä¸æ˜¯æˆ‘å€‘æƒ³è¦çš„çµæœï¼Œå› æ­¤æˆ‘å€‘éœ€è¦æ·»åŠ ä¸€äº›é¡å¤–çš„é™åˆ¶ï¼Œè€Œ **é‚Šç•Œå’Œå‰ç»å¯ä»¥å¹«åŠ©æˆ‘å€‘è§£æ±ºé€™å€‹å•é¡Œ**ã€‚

#### 1. é‚Šç•Œï¼ˆBoundariesï¼‰

é‚Šç•Œæ˜¯åœ¨æ­£å‰‡è¡¨é”å¼ä¸­ç”¨ä¾†é™åˆ¶åŒ¹é…æ¨¡å¼çš„ä½ç½®æ¨™è¨˜ã€‚å®ƒå€‘ä¸æœƒåŒ¹é…ä»»ä½•å¯¦éš›å­—å…ƒï¼Œè€Œæ˜¯å¼·åˆ¶åœ¨æ¨¡å¼ä¸­å‡ºç¾çš„ä½ç½®æ»¿è¶³ç‰¹å®šæ¢ä»¶ã€‚å¸¸è¦‹çš„é‚Šç•Œç¬¦è™ŸåŒ…æ‹¬ï¼š

- `^`ï¼šåŒ¹é…å­—ä¸²é–‹é ­
    ```javascript
    let startWithNumber = /^\d+/;
    console.log(startWithNumber.test("123abc"));  // â†’ true
    console.log(startWithNumber.test("abc123"));  // â†’ false
    ```
- `$`ï¼šåŒ¹é…å­—ä¸²çµå°¾
    ```javascript
    let endWithNumber = /\d+$/;
    console.log(endWithNumber.test("abc123"));  // â†’ true
    console.log(endWithNumber.test("123abc"));  // â†’ false
    ```
- `^` èˆ‡ `$` çµ„åˆï¼šåŒ¹é…æ•´å€‹å­—ä¸²
    ```javascript
    let numbers = /\d+/;  // æœªä½¿ç”¨ ^ å’Œ $
    console.log(numbers.test("123"));  // â†’ true
    console.log(numbers.test("123abc"));  // â†’ true
    console.log(numbers.test("abc123"));  // â†’ true

    let onlyNumbers = /^\d+$/;
    console.log(onlyNumbers.test("123"));  // â†’ true
    console.log(onlyNumbers.test("123abc"));  // â†’ false
    console.log(onlyNumbers.test("abc123"));  // â†’ false
    ```
- `\b`ï¼šåŒ¹é…å–®è©é‚Šç•Œ
    ```javascript
    let wordBoundary = /\bcat\b/;
    console.log(wordBoundary.test("The cat is"));  // â†’ true
    console.log(wordBoundary.test("category"));  // â†’ false
    ```

#### 2. å‰ç»ï¼ˆLookaheadï¼‰

å‰ç»æ˜¯ä¸€ç¨®ç‰¹æ®Šçš„åŒ¹é…æ¢ä»¶ï¼Œå…è¨±ä½ æª¢æŸ¥æŸå€‹æ¨¡å¼æ˜¯å¦å­˜åœ¨æ–¼åŒ¹é…çš„ä½ç½®ï¼Œä½†ä¸æœƒå°‡é€™äº›å­—å…ƒåŒ…å«åœ¨åŒ¹é…çµæœä¸­ã€‚å‰ç»å¯ä»¥åˆ†ç‚ºå…©ç¨®é¡å‹ï¼šæ­£å‘å‰ç»å’Œè² å‘å‰ç»ã€‚

##### 2.1 æ­£å‘å‰ç» `(?=pattern)`

è¦æ±‚å¾Œé¢åŒ¹é…ç‰¹å®šæ¨¡å¼ï¼Œä½†ä¸æ¶ˆè€—é€™äº›å­—å…ƒã€‚

```javascript
let followedByE = /a(?=e)/;  // a æ­£å¾Œé¢å¿…é ˆæœ‰ e
console.log(followedByE.exec("braeburn"));  // â†’ ["a"]
console.log(followedByE.exec("brain"));  // â†’ null
console.log(followedByE.exec("babe"));  // â†’ nullï¼Œe å¿…é ˆåœ¨ a çš„ä¸‹ä¸€å€‹å­—å…ƒ
```

##### 2.2 è² å‘å‰ç» `(?!pattern)`

è¦æ±‚å¾Œé¢ä¸åŒ¹é…ç‰¹å®šæ¨¡å¼ï¼Œä½†ä¸æ¶ˆè€—é€™äº›å­—å…ƒã€‚

```javascript
let notFollowedBySpace = /a(?! )/;  // a æ­£å¾Œé¢ä¸èƒ½æœ‰ç©ºæ ¼
console.log(notFollowedBySpace.test("a b"));  // â†’ false
console.log(notFollowedBySpace.test("ab"));  // â†’ true
console.log(notFollowedBySpace.test("ab "));  // â†’ trueï¼Œç©ºæ ¼å¿…é ˆåœ¨ a çš„ä¸‹ä¸€å€‹å­—å…ƒ
```

#### å‰µå»ºæ—¥æœŸç¯„ä¾‹

ç‚ºäº†ç¢ºä¿å‰µå»ºæ—¥æœŸçš„æ ¼å¿…ç‚º `MM-DD-YYYY`ï¼Œå¯ä»¥æ”¹æˆå¦‚ä¸‹æ ¼å¼ï¼š

```javascript
function getDate(string) {
  let [_, month, day, year] =
    /^(\d{1,2})-(\d{1,2})-(\d{4})$/.exec(string) || [];
  if (!month || !day || !year) return "Invalid Date";
  return new Date(year, month - 1, day);
}

console.log(getDate("01-30-2003"));  // â†’ Thu Jan 30 2003 00:00:00 GMT+0100 (CET)
console.log(getDate("1-30-2003"));  // â†’ Thu Jan 30 2003 00:00:00 GMT+0100 (CET)
console.log(getDate("100-1-30000"));  // â†’ Invalid Date
```

#### çµ„åˆä½¿ç”¨ç¯„ä¾‹

```javascript
// åŒ¹é…ä»¥å­—æ¯é–‹é ­ï¼Œå¾Œé¢è·Ÿè‘—æ•¸å­—ï¼Œä½†ä¸èƒ½è·Ÿè‘—ç©ºæ ¼çš„å­—ä¸²
let complexPattern = /^[a-z](?!\s)\d+$/;
console.log(complexPattern.test("a123"));  // â†’ true
console.log(complexPattern.test("a 123"));  // â†’ false
console.log(complexPattern.test("1a123"));  // â†’ false
```

## é‹ä½œæ©Ÿåˆ¶

![é‹ä½œæ©Ÿåˆ¶](/img/articles/eloquent-JavaScript/9.é‹ä½œæ©Ÿåˆ¶.svg)

#### 1. é¸æ“‡æ¨¡å¼

åœ¨æ­£å‰‡è¡¨é”å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ç®¡é“ç¬¦è™Ÿ `|` ä¾†è¡¨ç¤ºé¸æ“‡æ¨¡å¼ï¼Œå…¶å…è¨±åŒ¹é…å¤šå€‹ä¸åŒçš„é¸æ“‡ã€‚

```javascript
let animalCount = /\d+ (pig|cow|chicken)s?/;
console.log(animalCount.test("15 pigs"));
// â†’ true
console.log(animalCount.test("15 pugs"));
// â†’ false
```

é€™å€‹ä¾‹å­ä¸­çš„æ¨¡å¼å¯ä»¥åŒ¹é…ï¼š

- æ•¸å­—å¾Œé¢æ¥è‘— "pig"ã€"cow" æˆ– "chicken"
- æœ€å¾Œå¯ä»¥é¸æ“‡æ€§åœ°åŠ ä¸Š "s" (ç”¨ `s?` è¡¨ç¤º)

![æ­£å‰‡è¡¨é”å¼çš„åŒ¹é…æ©Ÿåˆ¶](/img/articles/eloquent-JavaScript/æ­£å‰‡è¡¨é”å¼çš„åŒ¹é…æ©Ÿåˆ¶.svg)

#### 2. åŒ¹é…æ©Ÿåˆ¶

ç•¶æ­£å‰‡è¡¨é”å¼å¼•æ“é–‹å§‹åŒ¹é…æ™‚ï¼Œå®ƒæœƒ:

1. å¾å­—ä¸²çš„é–‹é ­é–‹å§‹å˜—è©¦åŒ¹é…
2. å¦‚æœç•¶å‰ä½ç½®ç„¡æ³•åŒ¹é…ï¼Œå‰‡ç§»å‹•åˆ°ä¸‹ä¸€å€‹å­—å…ƒç¹¼çºŒå˜—è©¦
3. ç›´åˆ°æ‰¾åˆ°ä¸€å€‹åŒ¹é…æˆ–åˆ°é”å­—ä¸²çµå°¾

```javascript
let pattern = /abc/;
console.log(pattern.test("abcde"));  // â†’ true
console.log(pattern.test("abdce"));  // â†’ false
```

##### 2.1 å›æº¯æ©Ÿåˆ¶

ç•¶æ­£å‰‡è¡¨é”å¼åŒ…å«å¤šå€‹å¯èƒ½çš„åŒ¹é…è·¯å¾‘æ™‚ï¼Œå¼•æ“æœƒä½¿ç”¨å›æº¯ï¼š

- è¨˜éŒ„ç•¶å‰çš„åŒ¹é…ä½ç½®
- å˜—è©¦ä¸€å€‹å¯èƒ½çš„åŒ¹é…è·¯å¾‘
- å¦‚æœå¤±æ•—ï¼Œå‰‡è¿”å›ä¹‹å‰çš„ä½ç½®å˜—è©¦å…¶ä»–è·¯å¾‘

```javascript
let number = /^(\d+|0x[0-9a-f]+)$/i;
console.log(number.test("123"));  // â†’ true
console.log(number.test("0xFF"));  // â†’ true
```

#### 3. æ•ˆèƒ½è€ƒé‡

æŸäº›æ­£å‰‡è¡¨é”å¼æ¨¡å¼å¯èƒ½å°è‡´éå¤šçš„å›æº¯ï¼Œå½±éŸ¿æ•ˆèƒ½ï¼š

```javascript
// ä¸å¥½çš„å¯«æ³• - å¯èƒ½å°è‡´éåº¦å›æº¯
let badPattern = /([01]+)+b/;

// æ›´å¥½çš„å¯«æ³•
let goodPattern = /[01]+b/;
```

æ•ˆèƒ½å»ºè­°ï¼š

- é¿å…éåº¦ä½¿ç”¨åµŒå¥—çš„é‡è¤‡é‹ç®—å­ (`+`,`*`)
- å„ªå…ˆä½¿ç”¨æ›´å…·é«”çš„æ¨¡å¼è€Œééæ–¼å¯¬é¬†çš„æ¨¡å¼
- ç•¶åªéœ€è¦ç°¡å–®åŒ¹é…æ™‚ï¼Œè€ƒæ…®ä½¿ç”¨å­—ä¸²æ–¹æ³•æ›¿ä»£

## å¯¦éš›æ‡‰ç”¨ï¼šè§£æ INI æ–‡ä»¶

#### 1. ä»€éº¼æ˜¯ INI æ–‡ä»¶

INI æª”æ¡ˆæ˜¯ä¸€ç¨®å¸¸è¦‹çš„è¨­å®šæª”æ ¼å¼ï¼Œä¸»è¦ç”¨ä¾†å„²å­˜ç¨‹å¼çš„è¨­å®šè³‡è¨Šã€‚

##### 1.1 æª”æ¡ˆæ ¼å¼è¦å‰‡

1. åŸºæœ¬çµæ§‹
    - å¯ä»¥æœ‰ä¸€èˆ¬è¨­å®šï¼ˆä¸å±¬æ–¼ä»»ä½•å€æ®µï¼‰
    - å¯ä»¥æœ‰å¤šå€‹å€æ®µï¼ˆsectionï¼‰
    - æ¯å€‹å€æ®µéƒ½æœ‰è‡ªå·±çš„è¨­å®šé …ç›®
2. èªæ³•è¦å‰‡
    - ç©ºè¡Œæœƒè¢«å¿½ç•¥
    - åˆ†è™Ÿï¼ˆ`;`ï¼‰é–‹é ­çš„æ˜¯è¨»è§£è¡Œ
    - å€æ®µæ¨™é¡Œæ ¼å¼ï¼š`[å€æ®µåç¨±]`
    - è¨­å®šé …æ ¼å¼ï¼š`åç¨±=å€¼`

```ini
searchengine=https://duckduckgo.com/?q=$1 ; ä¸€èˆ¬è¨­å®š
spitefulness=9.7

; é€™æ˜¯è¨»è§£
[larry] ; å€æ®µé–‹å§‹
fullname=Larry Doe
type=kindergarten bully

[davaeorn] ; å¦ä¸€å€‹å€æ®µ
fullname=Davaeorn
type=evil wizard
```

#### 2. è§£æå™¨å¯¦ä½œé‡é»

##### 2.1 åˆ†å‰²è¡Œ

```javascript
string.split(/\r?\n/)
```

- ç”¨æ­£å‰‡è¡¨é”å¼ `/\r?\n/` ä¾†è™•ç†ä¸åŒä½œæ¥­ç³»çµ±çš„æ›è¡Œç¬¦
- `\r?` è¡¨ç¤ºå¯èƒ½æœ‰æˆ–æ²’æœ‰å›è»Šç¬¦ï¼ˆWindows ç”¨ `\r\n`ï¼ŒUnix ç”¨ `\n`ï¼‰

##### 2.2 æ ¸å¿ƒé‚è¼¯

```javascript
function parseINI(string) {
    let result = {};  // å„²å­˜æ‰€æœ‰è¨­å®š
    let section = result;  // ç›®å‰æ­£åœ¨è™•ç†çš„å€æ®µ
    
    for (let line of string.split(/\r?\n/)) {
      // è™•ç†æ¯ä¸€è¡Œâ€¦
    }
    return result;
}
```

##### 2.3 ä¸‰ç¨®åŒ¹é…æ¨¡å¼

1. ä¸€èˆ¬è¨­å®šï¼šå¦‚ `name=value`
    ```javascript
    /^(\w+)=(.*)$/
    ```
2. å€æ®µæ¨™é¡Œï¼šå¦‚ `[section]`
    ```javascript
    /^\[(.*)\]$/
    ```
3. è¨»è§£æˆ–ç©ºè¡Œ
    ```javascript
    /^\s*(;|$)/
    ```

#### 3. è§£æçµæœç¯„ä¾‹

```javascript
// è¼¸å…¥ï¼š
name=Vasilis
[address]
city=Tessaloniki

// è¼¸å‡ºï¼š
{
    name: "Vasilis",
    address: {
        city: "Tessaloniki"
    }
}
```

#### 4. å®Œæ•´ç¨‹å¼ç¢¼

```javascript
function parseINI(string) {
  let result = {};
  let section = result;
  for (let line of string.split(/\r?\n/)) {
    let match;
    if (match = line.match(/^(\w+)=(.*)$/)) {
      section[match[1]] = match[2];
    } else if (match = line.match(/^\[(.*)\]$/)) {
      section = result[match[1]] = {};
    } else if (!/^\s*(;|$)/.test(line)) {
      throw new Error("Line '" + line + "' is not valid.");
    }
  };
  return result;
}

console.log(parseINI(`
name=Vasilis
[address]
city=Tessaloniki`));
// â†’ {name: "Vasilis", address: {city: "Tessaloniki"}}
```


## ç¸½çµ

æœ¬æ–‡é€éæ·±å…¥æ·ºå‡ºçš„æ–¹å¼ï¼Œæ¢è¨äº† JavaScript ä¸­çš„æ­£å‰‡è¡¨é”å¼ï¼ˆRegular Expressionï¼‰ã€‚å¾æœ€åŸºæœ¬çš„æ­£å‰‡è¡¨é”å¼æ¦‚å¿µï¼Œåˆ°é€²éšçš„åŒ¹é…æ©Ÿåˆ¶å’Œå¯¦éš›æ‡‰ç”¨ï¼Œé€æ­¥å±•ç¤ºäº†å¦‚ä½•æœ‰æ•ˆåœ°ä½¿ç”¨æ­£å‰‡è¡¨é”å¼é€²è¡Œæ–‡å­—è™•ç†ã€‚åŒæ™‚ä¹Ÿèªªæ˜äº†ä¸åŒåŒ¹é…æ–¹æ³•çš„ç‰¹æ€§ã€é‚Šç•Œæ¢ä»¶è™•ç†ï¼Œä»¥åŠæ•ˆèƒ½å„ªåŒ–ç­‰é‡è¦æ¦‚å¿µã€‚

#### é—œéµè¦é»

- æ­£å‰‡è¡¨é”å¼æ˜¯è™•ç†æ–‡å­—æ¨¡å¼çš„å¼·å¤§å·¥å…·
- å­—å…ƒé›†åˆå’Œé‡è¤‡æ¨¡å¼æ˜¯æ§‹å»ºè¤‡é›œåŒ¹é…çš„åŸºç¤
- åˆ†çµ„æ©Ÿåˆ¶èƒ½å¤ æä¾›æ›´ç²¾ç¢ºçš„åŒ¹é…æ§åˆ¶
- è²ªå©ªèˆ‡éè²ªå©ªåŒ¹é…å½±éŸ¿åŒ¹é…çµæœçš„ç¯„åœ
- é‚Šç•Œå’Œå‰ç»æä¾›äº†ç²¾ç¢ºçš„ä½ç½®æ§åˆ¶
- é¸æ“‡åˆé©çš„åŒ¹é…æ–¹æ³•å°æ•ˆèƒ½è‡³é—œé‡è¦

#### å¯¦è¸å»ºè­°

- å„ªå…ˆä½¿ç”¨å­—é¢é‡æ–¹å¼å‰µå»ºæ­£å‰‡è¡¨é”å¼
- å–„ç”¨æ¸¬è©¦æ–¹æ³•ç¢ºèªåŒ¹é…çµæœ
- æ³¨æ„è²ªå©ªåŒ¹é…å¯èƒ½å¸¶ä¾†çš„å•é¡Œ
- åˆç†ä½¿ç”¨åˆ†çµ„æé«˜åŒ¹é…ç²¾ç¢ºåº¦
- è€ƒæ…®æ•ˆèƒ½å› ç´ é¸æ“‡é©ç•¶çš„åŒ¹é…ç­–ç•¥

ä»¥ä¸Šå…§å®¹æ˜¯åŸºæ–¼ [9. Regular Expressions - Eloquent JavaScript 4th edition (2024)](https://eloquentjavascript.net/09_regexp.html){target="_blank"} æ‰€æ•´ç†çš„ç²¾ç°¡ç­†è¨˜ã€‚